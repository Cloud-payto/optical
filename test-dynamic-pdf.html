<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Dynamic PDF Generation</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 4px;
      border-left: 4px solid #6366f1;
    }
    .test-section h2 {
      margin-top: 0;
      color: #6366f1;
      font-size: 18px;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-right: 10px;
      margin-bottom: 10px;
      transition: background 0.2s;
    }
    button:hover {
      background: #4f46e5;
    }
    button:active {
      transform: scale(0.98);
    }
    .info {
      background: #e0e7ff;
      padding: 12px;
      border-radius: 4px;
      margin-top: 15px;
      font-size: 14px;
      color: #4338ca;
    }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 10px;
    }
    .error {
      background: #fee;
      color: #c00;
      padding: 12px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Dynamic PDF Layout Test</h1>
    <p class="subtitle">Test the new dynamic column width system with various data scenarios</p>

    <div class="test-section">
      <h2>Test 1: Modern Optical (From Screenshot)</h2>
      <p>Tests the exact data from your Modern Optical screenshot with long MODEL values</p>
      <button onclick="testModernOptical()">Generate Modern Optical PDF</button>
      <div class="info">
        This test includes items like "BEAUTIFUL", "DETERMINED", "ULTIMATE" in the MODEL column
        and long COLOR values like "BLACK/BURG CRY", "NAVY CRYST/BRN"
      </div>
    </div>

    <div class="test-section">
      <h2>Test 2: Luxottica (From Screenshot)</h2>
      <p>Tests the exact data from your Luxottica screenshot with very long COLOR values</p>
      <button onclick="testLuxottica()">Generate Luxottica PDF</button>
      <div class="info">
        This test includes extremely long COLOR values like "DARK HAVANA / DEMO LENS",
        "LIGHT GOLD / BROWN GRADIENT", "TRANSPARENT BLUE / DEMO LENS"
      </div>
    </div>

    <div class="test-section">
      <h2>Test 3: Edge Cases</h2>
      <p>Tests extreme scenarios to ensure robustness</p>
      <button onclick="testShortData()">Short Data (All Columns Minimal)</button>
      <button onclick="testVeryLongData()">Very Long Data (Stress Test)</button>
      <button onclick="testMixedData()">Mixed Length Data</button>
      <button onclick="testLargeReport()">Large Report (50 items)</button>
    </div>

    <div class="test-section">
      <h2>Debug Console</h2>
      <p>Open browser console (F12) to see column width calculations</p>
      <pre id="debugOutput">Click any test button to see debug output here...</pre>
    </div>
  </div>

  <script type="module">
    // Mock data for testing
    const modernOpticalData = [
      { brand: 'GB+ COLLECTION', model: 'BEAUTIFUL', color: 'BLACK/GOLD', size: '56', quantity: 1 },
      { brand: 'GB+ COLLECTION', model: 'DETERMINED', color: 'TEAL/PINK', size: '58', quantity: 1 },
      { brand: 'MODERN PLASTICS', model: 'ULTIMATE', color: 'BLACK/BURG CRY', size: '54', quantity: 1 },
      { brand: 'MODERN PLASTICS', model: 'FICTION', color: 'BLACK/CRYST GRY', size: '53', quantity: 1 },
      { brand: 'MODERN PLASTICS', model: 'GRADIENT', color: 'NAVY CRYST/BRN', size: '52', quantity: 1 }
    ];

    const luxotticaData = [
      { brand: 'BURBERRY', model: '0BE2444U', color: 'DARK HAVANA / DEMO LENS', size: '', quantity: 1 },
      { brand: 'BURBERRY', model: '0BE3080', color: 'LIGHT GOLD / BROWN GRADIENT', size: '', quantity: 1 },
      { brand: 'DOLCE E GABBANA', model: '0DG3425', color: 'HAVANA BLUE / DEMO LENS', size: '', quantity: 1 },
      { brand: 'DOLCE E GABBANA', model: '0DG3426', color: 'TRANSPARENT BLUE / DEMO LENS', size: '', quantity: 1 },
      { brand: 'PRADA', model: '0PR B03V', color: 'BLACK / DEMO LENS', size: '52', quantity: 1 },
      { brand: 'PRADA', model: '0PR B09V', color: 'MATTE BLACK / DEMO LENS', size: '', quantity: 1 }
    ];

    const shortData = [
      { brand: 'A', model: 'B1', color: 'RED', size: '50', quantity: 1 },
      { brand: 'B', model: 'C2', color: 'BLUE', size: '52', quantity: 2 }
    ];

    const veryLongData = [
      {
        brand: 'SUPER EXTRA LONG BRAND NAME',
        model: 'EXTREMELY LONG MODEL NUMBER WITH MANY CHARACTERS',
        color: 'VERY DESCRIPTIVE COLOR NAME WITH MULTIPLE WORDS AND SLASHES / DEMO LENS / POLARIZED',
        size: '54-18-140',
        quantity: 999
      }
    ];

    const mixedData = [
      { brand: 'SHORT', model: 'A', color: 'RED', size: '50', quantity: 1 },
      { brand: 'MEDIUM LENGTH BRAND', model: 'MEDIUM MODEL', color: 'BLUE / GRADIENT', size: '52', quantity: 5 },
      { brand: 'VERY LONG BRAND NAME HERE', model: 'SUPER LONG MODEL NUMBER', color: 'EXTREMELY LONG COLOR DESCRIPTION WITH MANY WORDS', size: '', quantity: 10 }
    ];

    function generateLargeReport() {
      const items = [];
      for (let i = 0; i < 50; i++) {
        items.push({
          brand: ['RAY-BAN', 'OAKLEY', 'PRADA', 'BURBERRY', 'DOLCE E GABBANA'][i % 5],
          model: `MODEL-${1000 + i}`,
          color: ['BLACK', 'BROWN / GRADIENT', 'BLUE HAVANA / DEMO LENS', 'TRANSPARENT / POLARIZED'][i % 4],
          size: ['50', '52', '54', '56', ''][i % 5],
          quantity: (i % 3) + 1
        });
      }
      return items;
    }

    // Store test functions in global scope
    window.testModernOptical = () => generatePDF(modernOpticalData, 'Modern Optical', 'RR-2025-282');
    window.testLuxottica = () => generatePDF(luxotticaData, 'Luxottica', 'RR-2025-869');
    window.testShortData = () => generatePDF(shortData, 'Test Vendor', 'RR-2025-001');
    window.testVeryLongData = () => generatePDF(veryLongData, 'Test Vendor', 'RR-2025-002');
    window.testMixedData = () => generatePDF(mixedData, 'Test Vendor', 'RR-2025-003');
    window.testLargeReport = () => generatePDF(generateLargeReport(), 'Test Vendor', 'RR-2025-999');

    async function generatePDF(items, vendorName, reportNumber) {
      const debugEl = document.getElementById('debugOutput');
      debugEl.textContent = 'Generating PDF...';

      try {
        // Intercept console.log to capture debug output
        const originalLog = console.log;
        let debugOutput = '';
        console.log = (...args) => {
          originalLog(...args);
          debugOutput += args.join(' ') + '\n';
        };

        // Import and call the generator
        const { generateReturnReportPDF, downloadPDF, generateReportFilename, formatReportDate } =
          await import('./src/features/inventory/utils/generateReturnReportPDF.ts');

        const metadata = {
          reportNumber,
          date: formatReportDate(),
          vendorName,
          contactEmail: 'returns@example.com',
          accountNumber: '123456'
        };

        const blob = await generateReturnReportPDF(items, metadata, { debug: true });
        const filename = generateReportFilename(vendorName, reportNumber);
        downloadPDF(blob, filename);

        // Restore console.log and show debug output
        console.log = originalLog;
        debugEl.textContent = debugOutput || 'PDF generated successfully! Check your downloads.';

      } catch (error) {
        console.error('Error generating PDF:', error);
        debugEl.innerHTML = `<div class="error">Error: ${error.message}</div>`;
      }
    }
  </script>
</body>
</html>
